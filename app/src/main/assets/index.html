<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <!-- JQuery isn't needed for JockeyJS, just used in this example. -->
    <script type="text/javascript" src="file:///android_asset/jquery-1.9.1.js"></script>

    <!-- Required includes. json2.js may not be required in specific instances. -->
    <script type="text/javascript" src="file:///android_asset/jockey.js"></script>

    <!--
    Jockey.send("write", {
			        command: opcode
			    });

			    Jockey.send("read");

			    setTimeout(doClose, 2000);
			    var result = "Serial: " + json.serial + "\n Product" + json.product  + "\nDescription" + json.description + "\nFirmware" + json.firmware  + "\n";

			    var array = returned.split(' ').map(function(c) {return parseInt(c, 16)});

		        console.log(array);

		        var result = decode_product_info(array);
		        var json = JSON.stringify(result);
    -->

    <script type="text/javascript">

            var opcode = [0x04,0x00];
            var opcode2 = "0x04,0x00";

			Jockey.on("send-opcode", function() {
			    Jockey.send("open");

			    setTimeout(doWrite, 1000);
			    setTimeout(doRead, 2000);

			});

			function doWrite() {
			    Jockey.send("write", { command: opcode2 } )
			}

			function doRead() {
			    Jockey.send("read");
			}

			function doClose() {
			    Jockey.send("close");
			}

			Jockey.on("doRead", function(payload) {
    			<!-- READ PAYLOAD -->
    			var returned = payload;
    			console.log(returned);

		        <!-- DECODE -->
		        var result = returned.split(' ')[1];

		        <!-- SEND BACK -->
		        Jockey.send("message", { message: result } )

		        <!-- CLOSE CONNECTION -->
		        Jockey.send("close");
			});

			function decode_product_info (data) {
                data = new Buffer(data.slice(3));
                return {
                      serial      : data.slice(0,3).toString('hex')
                    , product     : [ data[3].toString( ), data[4].toString( ) ].join('.')
                    , description : data.slice(6, 16).toString( )
                    , firmware    : [ data[16].toString( ), data[17].toString( ) ].join('.')

                };
            }
    </script>

</head>
<body>

<span id="counter">0</span>

</body>
</html>

